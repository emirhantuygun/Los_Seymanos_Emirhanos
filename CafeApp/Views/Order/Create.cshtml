@model Tuple<List<Product>, Order>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/index.css">
    <title>Product List</title>
</head>

<body>

    <div class="container">
        <div class="row justify-content-center">
            <div id="ProductsList" class="col-8">
                @{
                    var groupedProducts = Model.Item1.GroupBy(p => p.Name);

                    foreach (var group in groupedProducts)
                    {
                        var firstProduct = group.First();
                        if (group.Count() == 1 || firstProduct.Type == "Dessert")
                        {
                            decimal price = firstProduct.Type == "Dessert" ? firstProduct.PriceDessert ?? 0 : 0;

                            <div class="product-card">
                                <img src="@firstProduct.ImageSrc" alt="@firstProduct.Name">
                                <h2>@firstProduct.Name</h2>
                                <p>$ @price</p>
                                <button class="bagButton" onclick="addToBag(@firstProduct.ProductId); printOrderDetails('@firstProduct.Name', @price);">Add to Bag</button>
                            </div>
                        }
                        else
                        {
                            <div class="product-card">
                                <img src="@firstProduct.ImageSrc" alt="@firstProduct.Name">
                                <h2>@firstProduct.Name</h2>
                                @foreach (var product in group)
                                {
                                    decimal price = product.Option == "Tall" ? product.PriceTall ?? 0 :
                                                    product.Option == "Grande" ? product.PriceGrande ?? 0 :
                                                    product.PriceVenti ?? 0;
                                    
                                    <input type="radio" name="@firstProduct.ProductId" id="@product.ProductId" title="@product.Name" placeholder="@product.Option" value="@price">
                                    <label for="@product.ProductId">@product.Option &nbsp; $@price</label><br>
                                }
                                <button class="bagButton" onclick="trigger('@firstProduct.ProductId')">Add to Bag</button>
                            </div>
                        }
                    }
                }
            </div>




            <div class="col-4">
                <div id="OrderForm" class="row">
                    <form asp-controller="Order" asp-action="Create" method="post">
                        <div>
                            <label asp-for="Item2.TableNo" class="form-label">Table Number</label>
                            <input asp-for="Item2.TableNo" name="number" class="form-control" required>
                        </div>

                        <div>
                            <label asp-for="Item2.CustomerName" class="form-label">Customer Name</label>
                            <input asp-for="Item2.CustomerName" name="name" class="form-control" required>
                        </div>

                        <button type="submit" onclick="check()" class="btn btn-primary">Order</button>
                    </form>
                </div>
                <br>
                <br>
                <div id="OrderDetails" class="row">
                    <table id="tbl">
                        <tr>
                            <th>Total:</th>
                            <th id="total">$ 0</th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <script>

        function trigger(inputId) {
            var selectedRadio = document.querySelector(`input[name="${inputId}"]:checked`);
            if (selectedRadio) {
                var id = selectedRadio.id;
                var name = selectedRadio.title;
                var price = selectedRadio.value;
                var option = selectedRadio.placeholder;

                addToBag(id);
                printOrderDetails(name, price, option);
            }
            else (
                alert("Please Choose an Option!")
            )
        }

        function addToBag(productId) {

            console.log("Adding to bag:", productId);

            $.ajax({
                type: "POST",
                url: "/Order/AddToBag",
                data: { productId: productId },
                success: function (response) {
                    // Handle success if needed
                },
                error: function (error) {
                    // Handle error if needed
                }
            });
        }

        function printOrderDetails(name, price, option) {

            var table = document.querySelector("#tbl");
            var tableRow = document.createElement("tr");

            var nameElement = document.createElement("td");
            if (option != undefined)
                nameElement.textContent = name + " " + option;
            else
                nameElement.textContent = name;

            var priceElement = document.createElement("td");
            priceElement.textContent = `$ ${price}`;

            tableRow.appendChild(nameElement);
            tableRow.appendChild(priceElement);
            table.insertBefore(tableRow, table.lastChild);

            var total = document.getElementById("total");
            var totalPrice = parseInt(total.textContent.substring(2)) + parseInt(price);
            total.textContent = `$ ${totalPrice}`;

        }

        function check() {
            var total = document.getElementById("total");
            var totalPrice = parseInt(total.textContent.substring(2));
            if(totalPrice == 0){
                alert("Please Choose a Product!");
            }
        }
    </script>
</body>

</html>
